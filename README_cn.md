# 合并有序数据块

![](https://github.com/codgician/merging-chunks/workflows/Rust/badge.svg)


第一次使用 Rust 写相对完整的程序，可能还有很多可改进的地方（求建议qwq）~

## 题目

为了方便，本次实现处理 `unsigned int64` 而非 `int64`。

给定 **k** 个满足下述条件的有序 `unsigned int64` 数据块（可看作数组）：

- 所有数值服从 **均匀分布**；
- 总数据量大致为 **1TiB**；

需要设计并实现一个将所有有序数据块合并的算法，同时应当尽可能利用多核处理器这一特性，并使用不超过 **16GiB** 内存。

## 思想

内存大小有限导致无法将所有数据放入内存处理，此时硬盘 I/O 性能可能成为瓶颈，故需要在理论复杂度与 I/O 次数间做妥协。注意到数据值域相对较小 (0 ~ 2^64 - 1)，因此考虑依据值域进行分段处理。

- 将 `[0 .. 2^64 - 1]` 切分成 512 (2^9) 长度相等的*段*。第 i 段记作 `p[i]`，且 `p[i] = [i * 2^55 .. i * 2^56  - 1]`；
- 对于每一*段* `p[i]`：
  - 遍历每一个数据块，筛选出所有大小坐落于 `p[i]` 中的数值，并存放于数组 `a[i]` 中；
  - 数据服从均匀分布，因此数组 `a[i]` 的大小不太可能超过内存限制；
  - 采用多线程排序算法对 `a[i]` 进行排序，然后写回硬盘；
- 按顺序连接硬盘上的所有排序结果。

